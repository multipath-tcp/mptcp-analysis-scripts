MPTCP Analysis Scripts
======================

This repository contains scripts to analyze and create graphs from PCAP files generated by the traffic between N smartphones and one proxy (or server).

Requirements
------------
If you want to use the main scripts, make sure you have installed Python >=2.6 (not Python 3) and the following dependencies:
  * [mptcptrace](https://bitbucket.org/bhesmans/mptcptrace)
  * [Matplotlib](http://matplotlib.org/)
  * [NumPy](https://pypi.python.org/pypi/numpy/)
  * [PyMongo](http://api.mongodb.org/python/current/)
  * [Tcpreplay](http://tcpreplay.appneta.com/wiki/installation.html#downloads)
  * [tstat](http://tstat.tlc.polito.it)
  * [tshark](https://www.wireshark.org/docs/man-pages/tshark.html)

The analysis scripts requires the creation of a new file, `config.py`. The content of this file must be the following:
```python
# IP address of the proxy/server
IP_PROXY = '1.2.3.4'
# Prefix of IPs belonging to WiFi access points
PREFIX_IP_WIFI = '192.168.'
# The password of SOCKS sessions
PASSWORD = 'My awesome password'
```

To have all functionalities, you also need to get
  * [SciPy](http://www.scipy.org/scipylib/download.html)
  * [Statsmodels](http://statsmodels.sourceforge.net/)
  * [tcpcsm](http://www.wand.net.nz/~salcock/tcpcsm/)

Produce stats files
-------------------
The main scripts are `analyze.py`, `mptcp.py`, `tcp.py` and `common.py`.
The three first ones are used to produce the statistic files useful to produce further graphs, whereas the last one contains various functions that can be used at different places.

If you want to produce results from traces generated by the [automated test framework](https://github.com/MPTCP-smartphone-thesis/uitests), you can launch

```bash
./analyze.py -i input_file_or_folder -j number_of_threads
```

This will produce several folders, containing among others the graphs generated by mptcptrace and tcptrace (`graphs*` folder) and  the statistic files that can be reused by other scripts (`stats*` folder).

The default behavior is not suitable for very large traces (for time and/or memory usage).
To analyze such traces, if those are known to contain only Multipath TCP traces, one can run

```bash
./analyze.py -i input_file_or_folder -p '' -M
```

This produces less outputs than the previous command, though you still obtain the most important ones.

You can also match flows with the smartphone interface.
Either you control one WiFi access point, and the definition of `PREFIX_IP_WIFI` is sufficient, or you have a database of this matching thanks to the [MultipathControl application](https://bitbucket.org/baertsm/multipathcontrol/overview) and our [REST server](https://github.com/MPTCP-smartphone-thesis/server-collect-mpctrl).
In that case, you can use the `-D` option, but you may need to modify the [`analyze.py` script](https://github.com/MPTCP-smartphone-thesis/pcap-measurement/blob/master/analyze.py#L222).

To have more detailed information on how to use it, you can show the help by typing

```bash
./analyze -h
```

Generation of results and graphs
--------------------------------

Once those statistic files are produced, you can agglomerate the different statistics obtained (by default in the `stats` folder).
A lot of example are provided, for instance in `summary.py`, `summary_imc.py`, `macro.py` and `seq_together.py`.
To produce your own summary script, you may be interested in the `MPTCPConnection` and `TCPConnection` objects (defined respectively in `mptcp.py` and `tcp.py`).


Details about the stats generated
---------------------------------
Statistics about analyzed traces are contained in a stats folder, by default `stats_any`.
Each file contains a dictionary of objects representing the connections, that can be read using `pickle.load(file)`.
Depending of the protocol indicated on the file, those objects are either `TCPConnection`s or `MPTCPConnection`s.
Both of them inherit from `BasicConnection`, defined in `common.py`.
Information related to connections is stored in the `attr` attribute, containing a dictionary.

The main difference between `TCPConnection` and `MPTCPConnection` is related to the number of (sub)flows they contain.
`TCPConnection` only has one flow, in the `flow` attribute, whereas `MPTPCConnection` can have more than one, in the dictionary `flows`.
In both cases, flows inherit from (or are) `BasicFlow`, which has the `attr` dictionary containing all information related to the flow.

Keys of `attr` dictionaries are defined in `common.py`.

License
-------
All the code in this repository is licensed under GPLv3 and is part of our Master Thesis "Multipath TCP with real Smartphone Applications".
The contributor are [Quentin De Coninck](https://github.com/qdeconinck) and [Matthieu Baerts](https://github.com/matttbe).
